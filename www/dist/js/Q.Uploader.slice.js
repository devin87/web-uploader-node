//devin87@qq.com
//build:2020/08/25 18:26:42
!function(e){"use strict";var m=Q.Uploader;if(m.support.html5){var o=e.File?File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice:void 0;m.extend({_upload_slice:function(a){var s,c=this,e=a.blob||a.file,p=e.size,n=c.chunkSize,d=a.sliceStart||0,u=c.sliceRetryCount,f=function(e,i,n){n=+n||0;var t=new XMLHttpRequest,o=a.url,r=s==p;a.xhr=t,o+=(-1==o.indexOf("?")?"?":"&")+"action=upload&hash="+(a.hash||a.name)+"&ok="+(r?"1":"0"),t.upload.addEventListener("progress",function(e){c.progress(a,p,d+e.loaded)},!1),t.addEventListener("load",function(e){var n=e.target.responseText;return r?c.complete(a,m.COMPLETE,n):1==n||'"1"'==n?i():void c.complete(a,m.ERROR,n)},!1),t.addEventListener("error",function(){if(++n>u)return c.complete(a,m.ERROR);f(e,i,n)},!1);var l=new FormData;c._process_params(a,function(e,n){l.append(e,n)}),l.append("fileName",a.name),-1!=a.size&&l.append("fileSize",a.size),l.append(c.upName,e,a.name),l.append("sliceCount",a.sliceCount),l.append("sliceIndex",a.sliceIndex),t.open("POST",o),c._process_xhr_headers(t),r?c.fire("send",a,function(e){if(!1===e)return c.complete(a,m.SKIP);t.send(l)}):t.send(l)};a.sliceCount=Math.ceil(p/n);function i(){p<=d||(p<(s=d+n)&&(s=p),a.sliceStart=d,a.sliceEnd=s,a.sliceIndex=Math.ceil(s/n),a.sliceBlob=o.call(e,d,s),c.fire("sliceUpload",a,function(e){if(!1===e)return t();f(a.sliceBlob,t)}))}var t=function(){d=s,i()};i(),c._afterSend(a)}})}}(window);