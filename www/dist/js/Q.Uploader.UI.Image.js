//devin87@qq.com
//build:2020/08/25 18:26:43
!function(n,d){"use strict";var p=Q.getFirst,m=Q.getNext,h=Q.createEle,b=Q.setOpacity,s=Q.ie,u=Q.Uploader;function i(e,t){e.className+=" "+t}function l(t,e,i){var a=e.input,r=e.file||(a.files?a.files[0]:d);if(r)!function(e,t){var i=n.URL||n.webkitURL;if(i)return t(i.createObjectURL(e));if(n.FileReader){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsDataURL(e)}else e.readAsDataURL&&t(e.readAsDataURL())}(r,function(e){e&&(t.innerHTML='<img src="'+e+'" />'),i&&i(e)});else if(a){var o=a.value;if(o&&!/^\w:\\fakepath/.test(o)||(a.select(),parent.document.body.focus(),document.selection&&(o=document.selection.createRange().text)),o){t.innerHTML='<img src="'+o+'" />';try{6<s&&(t.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+o+"')")}catch(e){}}i&&i(o)}}var c=n.Blob||n.WebkitBlob||n.MozBlob,f=n.WebKitBlobBuilder||n.MozBlobBuilder,a=function(){if(!n.FileReader||!n.atob||!c&&!f)return!1;var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")}();function v(e,l,c,d){var u=new Image;u.src=e,u.onload=function(){var e=u.width,t=u.height,i=c.maxWidth,a=c.maxHeight,r=i&&i<e,o=a&&a<t;if(!(r||o))return d&&d(!1);r&&(e=i,t=Math.floor(u.height*e/u.width)),o&&(t=a,e=Math.floor(u.width*t/u.height));var n=document.createElement("canvas"),s=n.getContext("2d");n.width=e,n.height=t,s.drawImage(u,0,0,e,t),d&&d(n.toDataURL(l),l)}}var r=".jpg,.png,.gif,.bmp,.webp,.tif,.tiff";u.support.imageScale=a,u.previewImage=l,u.scaleImage=v,u.UI.Image={init:function(){var e=this.ops,t=e.view;e.allows||(e.allows=r),t&&i(t,"ui-image "+(this.html5?"html5":"html4"))},supportScale:function(e){if(!a)return!1;".jpeg"==e&&(e=".jpg");var t=(this.ops.scale||{}).types||".jpg";return-1!=r.indexOf(e)&&("*"==t||-1!=t.indexOf(e))},previewImage:function(e,a,t){var r=this,o=a.scale||t.scale,n=o&&r.supportScale(a.ext);return n&&(a.skip=!0),l(e,a,function(e){var t,i;r.fire("preview",{task:a,src:e}),e&&n&&v(e,(t=a.ext,"image/"+("jpg"==(i=t.slice(1))?"jpeg":i)),o,function(e,t){if(e){var i=function(e,t){for(var i=e.split(","),a=atob(i[1]),r=[],o=0,n=a.length;o<n;o++)r[o]=a.charCodeAt(o);if(c)return new c([new Uint8Array(r)],{type:t});var s=new f;return s.append(r),s.getBlob(t)}(e,t);a.blob=i,r.fire("scale",{task:a,base64:e,type:t,blob:i})}a.skip=!1,r.list.push(a),r.auto&&r.start()})}),r},draw:function(e){var t=this,i=t.ops,a=i.view;if(a){var r=e.name,o='<div class="u-img"></div><div class="u-progress-bar"><div class="u-progress"></div></div><div class="u-detail"></div><div class="u-name" title="'+r+'">'+r+'</div><div class="u-close-bg"></div><div class="u-close-text">X</div>',n=e.id,s=h("div","u-item",o);s.taskId=n;var l=p(s),c=m(l),d=p(c),u=m(c),f=m(u),v=m(f),g=m(v);b(c,.3),b(d,.5),b(v,.3),g.onclick=function(){a.removeChild(s),t.remove(n)},e.box=s,e.boxProgress=d,e.boxDetail=u,e.boxName=f,a.appendChild(s),t.previewImage(l,e,i).update(e)}},update:function(e){if(e&&e.box){var t,i,a=e.total||e.size,r=e.loaded,o=e.state,n=e.boxProgress,s=e.boxDetail,l=u.getStatusText(o);if(this.html5&&r!=d&&0<=r){var c;if(o==u.PROCESSING)"100.0"==(c=Math.min(100*r/a,100).toFixed(1))&&(c="99.9");else o==u.COMPLETE&&(c="100");c&&(l+=" "+(c+="%"),n.style.width=c)}i=l,(t=s)&&(t.innerHTML=i||"")}},over:function(e){e&&e.box&&i(e.box,"u-over")}},u.extend(u.UI.Image)}(window);