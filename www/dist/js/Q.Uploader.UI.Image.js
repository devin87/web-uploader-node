//devin87@qq.com
//build:2021/08/18 17:20:24
!function(o,s){"use strict";var f=Q.getFirst,p=Q.getNext,v=Q.createEle,m=Q.setOpacity,n=Q.ie,l=Q.Uploader;function i(e,t){e.className+=" "+t}function c(t,e,i){var a=e.input,e=e.file||(a.files?a.files[0]:s);if(e)!function(e,t){var i=o.URL||o.webkitURL;if(i)return t(i.createObjectURL(e));o.FileReader?((i=new FileReader).onload=function(e){t(e.target.result)},i.readAsDataURL(e)):e.readAsDataURL&&t(e.readAsDataURL())}(e,function(e){e&&(t.innerHTML='<img src="'+e+'" />'),i&&i(e)});else if(a){var r=a.value;if(r&&!/^\w:\\fakepath/.test(r)||(a.select(),parent.document.body.focus(),document.selection&&(r=document.selection.createRange().text)),r){t.innerHTML='<img src="'+r+'" />';try{6<n&&(t.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+r+"')")}catch(e){}}i&&i(r)}}var d=o.Blob||o.WebkitBlob||o.MozBlob,u=o.WebKitBlobBuilder||o.MozBlobBuilder,a=function(){if(!o.FileReader||!o.atob||!d&&!u)return!1;var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")}();function g(e,n,s,l){var c=new Image;c.src=e,c.onload=function(){var e=c.width,t=c.height,i=s.maxWidth,a=s.maxHeight,r=i&&i<e,o=a&&a<t;if(!(r||o))return l&&l(!1);r&&(e=i,t=Math.floor(c.height*e/c.width)),o&&(t=a,e=Math.floor(c.width*t/c.height));o=document.createElement("canvas"),a=o.getContext("2d");o.width=e,o.height=t,a.drawImage(c,0,0,e,t),l&&l(o.toDataURL(n),n)}}var r=".jpg,.png,.gif,.bmp,.webp,.tif,.tiff";l.support.imageScale=a,l.previewImage=c,l.scaleImage=g,l.UI.Image={init:function(){var e=this.ops,t=e.view;e.allows||(e.allows=r),t&&i(t,"ui-image "+(this.html5?"html5":"html4"))},supportScale:function(e){if(!a)return!1;".jpeg"==e&&(e=".jpg");var t=(this.ops.scale||{}).types||".jpg";return-1!=r.indexOf(e)&&("*"==t||-1!=t.indexOf(e))},previewImage:function(e,a,t){var r=this,i=a.scale||t.scale,o=i&&r.supportScale(a.ext);return o&&(a.skip=!0),c(e,a,function(e){r.fire("preview",{task:a,src:e}),e&&o&&g(e,"image/"+("jpg"==(e=(e=a.ext).slice(1))?"jpeg":e),i,function(e,t){var i;e&&(i=function(e,t){for(var e=e.split(","),i=atob(e[1]),a=[],r=0,o=i.length;r<o;r++)a[r]=i.charCodeAt(r);return d?new d([new Uint8Array(a)],{type:t}):((e=new u).append(a),e.getBlob(t))}(e,t),a.blob=i,r.fire("scale",{task:a,base64:e,type:t,blob:i})),a.skip=!1,r.list.push(a),r.auto&&r.start()})}),r},draw:function(e){var t,i,a,r,o,n,s,l,c,d=this,u=d.ops,g=u.view;g&&(c='<div class="u-img"></div><div class="u-progress-bar"><div class="u-progress"></div></div><div class="u-detail"></div><div class="u-name" title="'+(l=e.name)+'">'+l+'</div><div class="u-close-bg"></div><div class="u-close-text">X</div>',t=e.id,(i=v("div","u-item",c)).taskId=t,a=f(i),r=p(a),o=f(r),n=p(r),s=p(n),l=p(s),c=p(l),m(r,.3),m(o,.5),m(l,.3),c.onclick=function(){g.removeChild(i),d.remove(t)},e.box=i,e.boxProgress=o,e.boxDetail=n,e.boxName=s,g.appendChild(i),d.previewImage(a,e,u).update(e))},update:function(e){var t,i,a,r,o,n;e&&e.box&&(t=e.total||e.size,i=e.loaded,a=e.state,r=e.boxProgress,n=e.boxDetail,e=l.getStatusText(a),this.html5&&i!=s&&0<=i&&(a==l.PROCESSING?"100.0"==(o=Math.min(100*i/t,100).toFixed(1))&&(o="99.9"):a==l.COMPLETE&&(o="100"),o&&(e+=" "+(o+="%"),r.style.width=o)),e=e,(n=n)&&(n.innerHTML=e||""))},over:function(e){e&&e.box&&i(e.box,"u-over")}},l.extend(l.UI.Image)}(window);